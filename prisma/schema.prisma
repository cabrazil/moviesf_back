generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_URL")
  relationMode = "prisma"
}

model Movie {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                  String                   @unique @db.VarChar(255)
  year                   Int?
  director               String?                  @db.VarChar(255)
  genres                 String[]
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  description            String?
  thumbnail              String?
  original_title         String?
  vote_average           Decimal?                 @db.Decimal(3, 1)
  vote_count             Int?
  certification          String?                  @db.VarChar(255)
  adult                  Boolean?                 @default(false)
  keywords               String[]
  genreIds               Int[]
  runtime                Int?
  tmdbId                 Int?                     @unique
  imdbRating             Decimal?                 @db.Decimal(3, 1)
  rottenTomatoesRating   Int?
  metacriticRating       Int?
  slug                   String?                  @unique @db.VarChar(255)
  landingPageHook        String?
  contentWarnings        String?
  targetAudienceForLP    String?
  awardsSummary          String?
  movieSentiments        MovieSentiment[]
  movieSuggestionFlows   MovieSuggestionFlow[]
  platforms              MovieStreamingPlatform[]
  cast                   MovieCast[]
  trailers               MovieTrailer[]
  awardNominations       MovieAwardNomination[]
  awardWins              MovieAwardWin[]
  personAwardNominations PersonAwardNomination[]  @relation("PersonAwardForMovie")
  personAwardWins        PersonAwardWin[]         @relation("PersonAwardForMovieWin")
  quotes                 Quote[]

  @@index([title])
  @@index([year])
  @@index([tmdbId])
  @@index([createdAt])
}

model Genre {
  id   Int    @id @default(autoincrement())
  name String @unique
}

model MainSentiment {
  id                  Int                  @id @default(autoincrement())
  name                String               @unique @db.VarChar(255)
  description         String?
  keywords            String[]             @default([])
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  shortDescription    String?
  journeyFlow         JourneyFlow?
  movieSentiment      MovieSentiment[]
  subSentiments       SubSentiment[]
  emotionalIntentions EmotionalIntention[]
}

model SubSentiment {
  id              Int              @id @default(autoincrement())
  name            String           @db.VarChar(255)
  description     String?
  keywords        String[]         @default([])
  mainSentimentId Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  movieSentiment  MovieSentiment[]
  mainSentiment   MainSentiment    @relation(fields: [mainSentimentId], references: [id])

  @@index([mainSentimentId])
}

model MovieSentiment {
  movieId         String        @db.Uuid
  mainSentimentId Int
  subSentimentId  Int
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  relevance       Decimal?      @db.Decimal(5, 3)
  explanation     String?
  mainSentiment   MainSentiment @relation(fields: [mainSentimentId], references: [id])
  movie           Movie         @relation(fields: [movieId], references: [id])
  subSentiment    SubSentiment  @relation(fields: [subSentimentId], references: [id])

  @@id([movieId, mainSentimentId, subSentimentId])
  @@index([movieId])
  @@index([mainSentimentId])
  @@index([subSentimentId])
}

model JourneyFlow {
  id              Int               @id @default(autoincrement())
  mainSentimentId Int               @unique
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  mainSentiment   MainSentiment     @relation(fields: [mainSentimentId], references: [id])
  steps           JourneyStepFlow[]
}

model JourneyStepFlow {
  id                             Int                             @id @default(autoincrement())
  journeyFlowId                  Int
  stepId                         String                          @db.VarChar(255)
  order                          Int
  question                       String
  createdAt                      DateTime                        @default(now())
  updatedAt                      DateTime                        @updatedAt
  options                        JourneyOptionFlow[]
  journeyFlow                    JourneyFlow                     @relation(fields: [journeyFlowId], references: [id])
  emotionalIntentionJourneySteps EmotionalIntentionJourneyStep[]

  @@index([journeyFlowId])
  @@index([order])
}

model JourneyOptionFlow {
  id                Int                   @id @default(autoincrement())
  journeyStepFlowId Int
  optionId          String                @db.VarChar(255)
  text              String
  nextStepId        String?               @db.VarChar(255)
  isEndState        Boolean               @default(false)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  displayTitle      String?
  journeyStepFlow   JourneyStepFlow       @relation(fields: [journeyStepFlowId], references: [id])
  movieSuggestions  MovieSuggestionFlow[]

  @@index([journeyStepFlowId])
  @@index([nextStepId])
}

model MovieSuggestionFlow {
  id                  Int               @id @default(autoincrement())
  journeyOptionFlowId Int
  movieId             String            @db.Uuid
  reason              String
  relevance           Int               @default(1)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  relevanceScore      Decimal?          @db.Decimal(5, 3)
  journeyOptionFlow   JourneyOptionFlow @relation(fields: [journeyOptionFlowId], references: [id])
  movie               Movie             @relation(fields: [movieId], references: [id])

  @@index([journeyOptionFlowId])
  @@index([movieId])
  @@index([relevanceScore])
}

model GenreSubSentiment {
  id             Int      @id @default(autoincrement())
  genreId        Int
  subSentimentId Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([genreId, subSentimentId])
}

model JourneyOptionFlowSubSentiment {
  id                  Int      @id @default(autoincrement())
  journeyOptionFlowId Int
  subSentimentId      Int
  weight              Decimal  @default(1.0) @db.Decimal(3, 2)
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  @@unique([journeyOptionFlowId, subSentimentId])
  @@index([journeyOptionFlowId])
  @@index([subSentimentId])
}

model EmotionalIntention {
  id                             Int                             @id @default(autoincrement())
  mainSentimentId                Int
  intentionType                  IntentionType
  description                    String
  preferredGenres                String[]                        @default([])
  avoidGenres                    String[]                        @default([])
  emotionalTone                  String                          @default("similar")
  subSentimentWeights            Json
  createdAt                      DateTime                        @default(now())
  updatedAt                      DateTime                        @updatedAt
  mainSentiment                  MainSentiment                   @relation(fields: [mainSentimentId], references: [id])
  emotionalIntentionJourneySteps EmotionalIntentionJourneyStep[]

  @@unique([mainSentimentId, intentionType])
  @@index([mainSentimentId])
  @@index([intentionType])
}

model EmotionalIntentionJourneyStep {
  id                   Int                @id @default(autoincrement())
  emotionalIntentionId Int
  journeyStepFlowId    Int
  priority             Int                @default(1)
  isRequired           Boolean            @default(false)
  customQuestion       String?
  contextualHint       String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  emotionalIntention   EmotionalIntention @relation(fields: [emotionalIntentionId], references: [id])
  journeyStepFlow      JourneyStepFlow    @relation(fields: [journeyStepFlowId], references: [id])

  @@unique([emotionalIntentionId, journeyStepFlowId])
  @@index([emotionalIntentionId])
  @@index([journeyStepFlowId])
  @@index([priority])
}

model StreamingPlatform {
  id                Int                      @id @default(autoincrement())
  name              String                   @unique @db.VarChar(255)
  category          PlatformCategory
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @default(now())
  logoPath          String?                  @db.VarChar(500)
  baseUrl           String?                  @db.VarChar(500)
  hasFreeTrial      Boolean                  @default(false)
  freeTrialDuration String?                  @db.VarChar(100)
  showFilter        ShowFilterType           @default(SECONDARY)
  movies            MovieStreamingPlatform[]

  @@index([category])
  @@index([showFilter])
}

model MovieStreamingPlatform {
  movieId             String            @db.Uuid
  streamingPlatformId Int
  accessType          AccessType
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @default(now())
  movie               Movie             @relation(fields: [movieId], references: [id])
  streamingPlatform   StreamingPlatform @relation(fields: [streamingPlatformId], references: [id])

  @@id([movieId, streamingPlatformId, accessType])
  @@index([movieId])
  @@index([streamingPlatformId])
}

model Actor {
  id               String                  @id @default(uuid()) @db.Uuid
  tmdbId           Int                     @unique
  name             String
  profilePath      String?
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @default(now())
  movies           MovieCast[]
  awardNominations PersonAwardNomination[]
  awardWins        PersonAwardWin[]

  @@index([tmdbId])
  @@index([name])
  @@map("Actor")
}

model MovieCast {
  id            String   @id @default(uuid()) @db.Uuid
  movieId       String   @db.Uuid
  actorId       String   @db.Uuid
  characterName String?
  order         Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  movie         Movie    @relation(fields: [movieId], references: [id])
  actor         Actor    @relation(fields: [actorId], references: [id])

  @@unique([movieId, actorId])
  @@index([movieId])
  @@index([actorId])
  @@map("MovieCast")
}

model MovieTrailer {
  id        String   @id @default(uuid()) @db.Uuid
  movieId   String   @db.Uuid
  tmdbId    String?
  key       String
  name      String?
  site      String
  type      String
  language  String?
  isMain    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  movie     Movie    @relation(fields: [movieId], references: [id])

  @@unique([movieId, key])
  @@index([movieId])
  @@index([tmdbId])
  @@map("MovieTrailer")
}

model Award {
  id                String                  @id @default(uuid()) @db.Uuid
  name              String                  @unique
  category          String?
  url               String?
  nominations       MovieAwardNomination[]
  wins              MovieAwardWin[]
  personNominations PersonAwardNomination[]
  personWins        PersonAwardWin[]
  categories        AwardCategory[]

  @@map("Award")
}

model AwardCategory {
  id                String                  @id @default(uuid()) @db.Uuid
  awardId           String                  @db.Uuid
  name              String
  award             Award                   @relation(fields: [awardId], references: [id])
  movieNominations  MovieAwardNomination[]
  movieWins         MovieAwardWin[]
  personNominations PersonAwardNomination[]
  personWins        PersonAwardWin[]

  @@unique([awardId, name])
  @@map("AwardCategory")
}

model MovieAwardNomination {
  id              String        @id @default(uuid()) @db.Uuid
  movieId         String        @db.Uuid
  awardId         String        @db.Uuid
  awardCategoryId String        @db.Uuid
  year            Int
  movie           Movie         @relation(fields: [movieId], references: [id])
  award           Award         @relation(fields: [awardId], references: [id])
  awardCategory   AwardCategory @relation(fields: [awardCategoryId], references: [id])

  @@unique([movieId, awardId, awardCategoryId, year])
  @@index([movieId])
  @@index([year])
  @@map("MovieAwardNomination")
}

model MovieAwardWin {
  id              String        @id @default(uuid()) @db.Uuid
  movieId         String        @db.Uuid
  awardId         String        @db.Uuid
  awardCategoryId String        @db.Uuid
  year            Int
  movie           Movie         @relation(fields: [movieId], references: [id])
  award           Award         @relation(fields: [awardId], references: [id])
  awardCategory   AwardCategory @relation(fields: [awardCategoryId], references: [id])

  @@unique([movieId, awardId, awardCategoryId, year])
  @@index([movieId])
  @@index([year])
  @@map("MovieAwardWin")
}

model PersonAwardNomination {
  id              String        @id @default(uuid()) @db.Uuid
  personId        String        @db.Uuid
  awardId         String        @db.Uuid
  awardCategoryId String        @db.Uuid
  year            Int
  forMovieId      String?       @db.Uuid
  person          Actor         @relation(fields: [personId], references: [id])
  award           Award         @relation(fields: [awardId], references: [id])
  awardCategory   AwardCategory @relation(fields: [awardCategoryId], references: [id])
  forMovie        Movie?        @relation("PersonAwardForMovie", fields: [forMovieId], references: [id])

  @@unique([personId, awardId, awardCategoryId, year])
  @@index([personId])
  @@index([forMovieId])
  @@index([year])
  @@map("PersonAwardNomination")
}

model PersonAwardWin {
  id              String        @id @default(uuid()) @db.Uuid
  personId        String        @db.Uuid
  awardId         String        @db.Uuid
  awardCategoryId String        @db.Uuid
  year            Int
  forMovieId      String?       @db.Uuid
  person          Actor         @relation(fields: [personId], references: [id])
  award           Award         @relation(fields: [awardId], references: [id])
  awardCategory   AwardCategory @relation(fields: [awardCategoryId], references: [id])
  forMovie        Movie?        @relation("PersonAwardForMovieWin", fields: [forMovieId], references: [id])

  @@unique([personId, awardId, awardCategoryId, year])
  @@index([personId])
  @@index([forMovieId])
  @@index([year])
  @@map("PersonAwardWin")
}

model Quote {
  id      Int     @id @default(autoincrement())
  movieId String  @db.Uuid
  text    String
  author  String?
  vehicle String?
  url     String? @db.VarChar(500)
  movie   Movie   @relation(fields: [movieId], references: [id])

  @@index([movieId])
  @@index([author])
  @@map("Quote")
}

enum IntentionType {
  PROCESS
  TRANSFORM
  MAINTAIN
  EXPLORE
}

enum AccessType {
  INCLUDED_WITH_SUBSCRIPTION
  RENTAL
  PURCHASE
  FREE_WITH_ADS
  OTHER
  HYBRID_OR_UNKNOWN
}

enum PlatformCategory {
  SUBSCRIPTION_PRIMARY
  RENTAL_PURCHASE_PRIMARY
  FREE_PRIMARY
  HYBRID
}

enum ShowFilterType {
  PRIORITY
  SECONDARY
  HIDDEN
}
